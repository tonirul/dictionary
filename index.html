<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictionary App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .dark .toggle-circle {
            transform: translateX(24px);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-300 text-gray-900 dark:text-gray-100">
    <div class="container mx-auto p-4 md:p-8 max-w-2xl">
        <!-- Header with Theme Toggle -->
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold">Dictionary</h1>
            <button id="theme-toggle" class="w-12 h-6 flex items-center bg-gray-300 dark:bg-gray-700 rounded-full p-1 transition-colors duration-300 shadow-md">
                <div class="toggle-circle w-4 h-4 bg-white rounded-full transition-transform duration-300 transform"></div>
            </button>
        </header>

        <!-- Search Bar -->
        <div class="relative mb-6">
            <input type="text" id="search-input" placeholder="Type a word..." class="w-full p-4 rounded-xl border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
            <button id="search-button" class="absolute right-4 top-1/2 -translate-y-1/2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg p-2 transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                </svg>
            </button>
            <div id="suggestions-container" class="absolute z-10 w-full bg-white dark:bg-gray-800 rounded-b-xl shadow-lg border border-gray-300 dark:border-gray-700 max-h-48 overflow-y-auto hidden"></div>
        </div>
        
        <!-- Loading and Error Messages -->
        <div id="status-message" class="text-center text-gray-600 dark:text-gray-400 font-medium"></div>

        <!-- Word Info Display Area -->
        <div id="word-info" class="hidden bg-white dark:bg-gray-800 rounded-xl p-6 md:p-8 shadow-lg"></div>
    </div>

    <script>
        // Use a window.onload event to ensure the entire page and all its elements are fully loaded
        window.onload = function() {
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const themeToggle = document.getElementById('theme-toggle');
            const wordInfoDiv = document.getElementById('word-info');
            const statusMessage = document.getElementById('status-message');
            const suggestionsContainer = document.getElementById('suggestions-container');

            // --- Theme Toggle Logic ---
            // Check for saved theme preference on page load
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme === 'dark') {
                document.documentElement.classList.add('dark');
            }

            themeToggle.addEventListener('click', () => {
                // Toggle the 'dark' class on the HTML element
                document.documentElement.classList.toggle('dark');
                // Save the new theme preference to local storage
                if (document.documentElement.classList.contains('dark')) {
                    localStorage.setItem('theme', 'dark');
                } else {
                    localStorage.setItem('theme', 'light');
                }
            });
            // --- End Theme Toggle Logic ---

            // Search and Display Logic
            searchButton.addEventListener('click', () => searchWord(searchInput.value));
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    searchWord(searchInput.value);
                }
            });
            
            // --- Word Suggestions Logic ---
            // This is the mock list of words. You can replace this with a call to a real API for suggestions.
            const mockSuggestions = ["apple", "banana", "hello", "world", "programming", "javascript", "dictionary", "beautiful", "courage", "knowledge"];
            
            // Listen for input events on the search bar
            searchInput.addEventListener('input', () => {
                const input = searchInput.value.toLowerCase();
                if (input.length > 0) {
                    // Filter the mock list to find words that start with the input
                    const filteredSuggestions = mockSuggestions.filter(word => word.startsWith(input));
                    displaySuggestions(filteredSuggestions);
                } else {
                    suggestionsContainer.classList.add('hidden');
                }
            });

            // Function to display the suggestions in the dropdown
            function displaySuggestions(words) {
                suggestionsContainer.innerHTML = '';
                if (words.length > 0) {
                    suggestionsContainer.classList.remove('hidden');
                    words.forEach(word => {
                        const suggestionItem = document.createElement('div');
                        suggestionItem.className = 'p-3 hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer transition-colors';
                        suggestionItem.textContent = word;
                        // When a suggestion is clicked, populate the search bar and perform a search
                        suggestionItem.addEventListener('click', () => {
                            searchInput.value = word;
                            searchWord(word);
                            suggestionsContainer.classList.add('hidden');
                        });
                        suggestionsContainer.appendChild(suggestionItem);
                    });
                } else {
                    suggestionsContainer.classList.add('hidden');
                }
            }
            // --- End Word Suggestions Logic ---

            async function searchWord(word) {
                if (!word) {
                    statusMessage.textContent = 'Please enter a word.';
                    wordInfoDiv.classList.add('hidden');
                    return;
                }

                wordInfoDiv.classList.add('hidden');
                statusMessage.innerHTML = '<div class="loader mx-auto"></div>';

                try {
                    const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                    if (!response.ok) {
                        throw new Error('Word not found or API error.');
                    }
                    const data = await response.json();
                    displayWordInfo(data[0]);
                } catch (error) {
                    statusMessage.textContent = error.message;
                }
            }
            
            async function fetchBengaliTranslation(word) {
                 const systemPrompt = "Provide a simple, single-sentence Bengali translation for the given English word.";
                 const userQuery = `What is the Bengali meaning of "${word}"?`;
                 const apiKey = "";
                 const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                 const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                 };

                 try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    return text || 'Translation not available.';
                 } catch (error) {
                    console.error("Error fetching Bengali translation:", error);
                    return 'Translation not available.';
                 }
            }

            async function displayWordInfo(data) {
                statusMessage.textContent = '';
                wordInfoDiv.classList.remove('hidden');
                
                const word = data.word;
                const phonetic = data.phonetic || 'N/A';
                const audioUrl = data.phonetics.find(p => p.audio)?.audio;

                let html = `
                    <div class="mb-6">
                        <h2 class="text-4xl font-bold mb-2">${word}</h2>
                        <div class="flex items-center space-x-4 text-gray-500 dark:text-gray-400 text-lg">
                            <span>${phonetic}</span>
                            ${audioUrl ? `<button id="play-audio" class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-500 flex items-center justify-center hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4.062a1 1 0 001.555.832l3-2.031a1 1 0 000-1.664l-3-2.031z" clip-rule="evenodd" /></svg></button>` : ''}
                        </div>
                    </div>
                `;
                
                // Fetch and display Bengali meaning
                html += `<div class="mb-4">
                            <h3 class="text-xl font-bold mb-2">Bengali Meaning</h3>
                            <p id="bengali-meaning" class="text-gray-700 dark:text-gray-300 italic">Fetching translation...</p>
                        </div>`;

                // Wait for the word to be rendered before fetching the translation
                wordInfoDiv.innerHTML = html;
                const bengaliMeaningElement = document.getElementById('bengali-meaning');
                
                // Use an IIFE to call the async function
                (async () => {
                    const bengaliMeaning = await fetchBengaliTranslation(word);
                    if (bengaliMeaningElement) {
                        bengaliMeaningElement.textContent = bengaliMeaning;
                    }
                })();

                if (audioUrl) {
                    document.getElementById('play-audio').addEventListener('click', () => {
                        new Audio(audioUrl).play();
                    });
                }

                // Definitions, Synonyms, and Antonyms
                data.meanings.forEach(meaning => {
                    html += `<div class="mb-6">
                        <h3 class="text-2xl font-bold capitalize mb-2">${meaning.partOfSpeech}</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 dark:text-gray-300">`;
                    
                    // Definitions in English
                    meaning.definitions.forEach((def, index) => {
                        html += `<li><span class="font-semibold">${index + 1}.</span> ${def.definition}</li>`;
                    });
                    
                    html += `</ul>`;
                    
                    // Synonyms
                    if (meaning.synonyms && meaning.synonyms.length > 0) {
                        html += `<div class="mt-4">
                            <h4 class="text-xl font-semibold">Synonyms:</h4>
                            <p class="text-gray-700 dark:text-gray-300">${meaning.synonyms.slice(0, 5).join(', ')}...</p>
                        </div>`;
                    }

                    // Antonyms
                    if (meaning.antonyms && meaning.antonyms.length > 0) {
                        html += `<div class="mt-4">
                            <h4 class="text-xl font-semibold">Antonyms:</h4>
                            <p class="text-gray-700 dark:text-gray-300">${meaning.antonyms.slice(0, 5).join(', ')}...</p>
                        </div>`;
                    }

                    // Forms of the part of speech (example)
                    // This data isn't always available in the API, so we'll provide a placeholder or derive it.
                    // For a real app, this would require a more robust API or a custom database.
                    if (meaning.partOfSpeech === 'noun') {
                        html += `<div class="mt-4">
                            <h4 class="text-xl font-semibold">Forms:</h4>
                            <p class="text-gray-700 dark:text-gray-300">Plural: ${word}s</p>
                        </div>`;
                    } else if (meaning.partOfSpeech === 'verb') {
                        html += `<div class="mt-4">
                            <h4 class="text-xl font-semibold">Forms:</h4>
                            <p class="text-gray-700 dark:text-gray-300">Past Tense: ${word}ed, Present Participle: ${word}ing</p>
                        </div>`;
                    }
                    
                    html += `</div>`;
                });

                wordInfoDiv.innerHTML = html;
            }
        };

    </script>
</body>
</html>